<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>进口商品</title>
    <meta name="renderer" content="webkit">
    <meta name="referrer" content="no-referrer" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <link rel="stylesheet" href="../../css/ImportCommodity.css?v=2" media="all">
    <link rel="stylesheet" href="../../css/Message.css?v=2" media="all">
    <link rel="stylesheet" href="/lib/layui-v2.6.3/font/font/iconfont.css" media="all">
    <style>
        .productList .product {
            border: solid 1px #ddd;
        }
    </style>
    <script type="text/javascript">
        console.log('load')
    </script>
</head>

<body>
    <div class="layuimini-main">
        <div class="" style="width: 100%;height:40px; margin: 20px 0px;">
            <form class="layui-form layui-form-pane" action="/share/ImportCommodity.html" method="get">
                <div class="model-select-box">
                    <div class="model-select-text" id="selectshop" value="" i18n_text="Input.Please.select;"><img
                            class="shoplogo" src="../../../images/shop.png" />Please Select</div>
                    <b class="bg1"></b>

                    <ul class="model-select-option" id="model-select-option">
                    </ul>
                </div>

                <div id="top-right" style="width: calc(100% - 310px); float: right;margin-left:30px; ">
                    <input type="text" i18n_Attr="placeholder:Input.commodity.title;" name="productTitle"
                        id="productTitle" lay-verify="title" autocomplete="off" placeholder="请输入商品标题"
                        class="inputprotitle">
                    <button id="searchBtn" type="submit" class="searchButton" lay-submit
                        lay-filter="data-search-btn"><img src="../../../images/sousuo.png" /></button>
                </div>



            </form>
        </div>

        <div id="productList" class="productList">
        </div>

        <!--分页-->
        <div id="test1" style="float:right;margin-right:40px;margin-bottom:50px;"></div>
        <!--批量操作栏-->
        <div id="total">
            <input class='TotalChk'
                style='border-color: #DDDDDD;border-radius: 5px;width: 20px;height: 20px;margin-top:20px;margin-left:40px;'
                type='checkbox' id='TotalChk' onclick="checkAllChange(this)">
            <span id="tatalSelect"></span>
            <input type="button" id="PushAllProduct" class="pushpro"
                style="float:right;margin-right:40px !important;margin-top:14px;" value="推送到商店"
                onclick="PushAllProduct()">
            <input type="button" id="DelAllProduct" class="deletepro"
                style="float: right; margin-top: 14px; border: 1px solid #DDDDDD; " i18n_text="deleteproduct"
                value="删除产品" onclick="DelAllProduct()">

        </div>
    </div>

    <script src="../../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="../../js/lay-module/wangEditor/wangEditor.js" charset="utf-8"></script>
    <script src="../../js/lay-module/wangEditor/i18next.min.js"></script>
    <script src="/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script src="/js/lay-config.js?v=2.0.1" charset="utf-8"></script>
    <script src="/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="/js/web-template.js"></script>
    <script src="/js/web-diff.js"></script>
    <script src="/js/lay-module/Message/Message.js?v=2" charset="utf-8"></script>
    <script type="text/javascript">
        var selectindex = 0;
        var Message;
        var id = "en_us";
        var lang = "en_us";
        var miniTab;
        console.log("come in")
        layui.use(['form', 'app', 'laypage', 'i18n', 'message', 'miniTab'], function () {
            console.log("user layui")
            var $ = layui.jquery,
                form = layui.form,
                layer = layui.layer,
                app = layui.app,
                i18n = layui.i18n,
                Message = layui.message,
                laypage = layui.laypage;

            miniTab = layui.miniTab;
            app.Load("client");
            // 国际化初始化
            var YDHConfig = layui.data('YDH');

            if (YDHConfig.Lang) {
                id = YDHConfig.Lang.id;
                lang = YDHConfig.Lang.id;
            }
            var ProCatalogueList = null;
            $.ajax({
                type: "get",
                url: BackgroundDomain + '/api/Product/GetProCatalogueList',
                async: false,
                success: function (data) {
                    ProCatalogueList = data;
                }
            });

            var count;
            var SerchproductInfo = new Object();
            //查找出该客户（管理员）的进口商品信息
            console.log('start QueryImportProduct')
            QueryImportProduct(count, SerchproductInfo);

            var prev = "";
            var next = "";
            if (id == "zh_cn") {
                prev = "上一页";
                next = "下一页";
            }
            else if (id == "en_us") {
                prev = "previous page";
                next = "next page ";
            }
            var Customer = layui.data('YDH-Customer');
            var dto_obj = new Object();
            dto_obj.email = Customer.email;
            dto_obj.Platform = "Shopify";
            // 获取店铺
            Getshop(form);

            function Getshop(form) {
                $.ajax({
                    type: "post",
                    url: BackgroundDomain + "/api/Customer/GetCustomerShopifyList",
                    contentType: "application/json;",
                    data: JSON.stringify(dto_obj),
                    dataType: "json",
                    success: function (e) {

                        let str = "";
                        for (let i of e.data) {
                            //组装数据
                            str += `<li shopify-id="${i.id}"><img class="shoplogo" src="../../../images/shop.png"/>${i.shopifyShop}</li>`;
                        }
                        str += `<li shopify-id="BingShop"><img class="shoplogo" src="../../../images/button/add.png"/>Bind new shop</li>`;
                        //jquery赋值方式
                        $("#model-select-option").html(str);


                    },
                    error: function (jqXHR) {
                        if (jqXHR.status != 401) {
                            layer.msg('获取失败！');
                        }
                        return false;
                    }
                });
            }

            var YDHCustomer = layui.data('YDH-Customer');
            function QueryImportProduct(count, SerchproductInfo) {
                console.log('in QueryImportProduct')
                var dto_obj = new Object();
                dto_obj.page = 1;
                dto_obj.limit = 10;
                dto_obj.dto = SerchproductInfo;
                var timestamp = new Date().getTime();
                console.log(timestamp); // 输出当前时间的毫秒数

                var myMsg = layer.msg("loading...", {
                    icon: 16,
                    time: -1
                })
                $.ajax({
                    type: "post",
                    contentType: "application/json",
                    url: BackgroundDomain + '/api/Product/QueryImportProductList?time=' + timestamp,
                    data: JSON.stringify(dto_obj),
                    success: function (msg) {
                        if (!msg) {
                            $("#productList").empty();
                            //获取div
                            var divf = document.getElementById("productList");
                            //添加div ，
                            var NoProduct = document.createElement("div");
                            NoProduct.setAttribute('class', 'NoProduct');
                            NoProduct.setAttribute('style', 'width:100%;');
                            divf.appendChild(NoProduct);
                            //放图片
                            var img = document.createElement("img");
                            img.setAttribute('style', 'display:block;text-align:center;margin:0px auto;margin-top:250px;');
                            img.setAttribute('src', '../../../images/404.png');
                            NoProduct.appendChild(img);

                            var content = document.createElement("div");
                            content.setAttribute('style', 'text-align:center;margin: 20px auto;');
                            NoProduct.appendChild(content);
                            content.html($.i18n.prop("No.content"));

                            var add = document.createElement("input");
                            add.setAttribute('type', 'buttom');
                            add.setAttribute('style', 'display:block;text-align:center;margin: 0px auto;width: 96px;height: 36px;border-radius: 18px;background:#673AB7;color:color: #333333;border:0px;font-weight: bold;cursor:pointer;');
                            add.setAttribute('class', 'add');
                            add.setAttribute('onclick', 'ToAddProduct()');
                            NoProduct.appendChild(add);
                            $(".add").val($.i18n.prop('TO.ADD'));
                            layer.close(myMsg);//手动关闭
                            return null;
                        }
                        count = msg.count;
                        //分页
                        laypage.render({
                            elem: 'test1' //注意，这里的 test1 是 ID，不用加 # 号
                            , prev: prev
                            , next: next
                            , count: count //数据总数，从服务端得到
                            , limit: 10
                            , jump: function (obj, first) {
                                dto_obj.page = obj.curr;
                                dto_obj.limit = obj.limit;
                                dto_obj.dto = SerchproductInfo;
                                // debugger
                                // if first. {

                                // }
                                $.ajax({
                                    type: "post",
                                    contentType: "application/json",
                                    url: BackgroundDomain + '/api/Product/QueryImportProductList?time=' + timestamp,
                                    data: JSON.stringify(dto_obj),
                                    success: function (msg) {
                                        var totalDiv = document.getElementById("total");
                                        totalDiv.style.display = "none"

                                        $("#productList").empty();
                                        var data = msg.data.length;
                                        //获取div
                                        var divf = document.getElementById("productList");

                                        for (var i = 0; i < data; i++) {

                                            var html = "";
                                            //添加div ，
                                            var div = document.createElement("div");
                                            div.setAttribute('class', 'product');
                                            div.setAttribute('id', 'product' + msg.data[i].id);
                                            divf.appendChild(div);

                                            var div1 = document.createElement("div");
                                            div1.setAttribute('class', 'producttop');
                                            div.appendChild(div1);

                                            var ul = document.createElement("ul");
                                            ul.setAttribute('class', 'productinfo');
                                            ul.setAttribute('id', 'productinfo' + msg.data[i].id);
                                            div1.appendChild(ul);
                                            html += "<li style='width:20px;'><input class='ProductChk' style='border-color: #DDDDDD;border-radius: 5px;width: 20px;height: 20px;margin-top:15px;' data-key='" + msg.data[i].id + "' type='checkbox' id='chk" + msg.data[i].id + "' onchange='UpdatecheckProduct(this)' ></li>";
                                            html += "<li style='width:20px;'></li>";
                                            html += "<li class='select' id='Images_Title" + msg.data[i].id + "'><font style='vertical-align:inherit;'><font class='in18product' style='vertical-align:inherit;'>产品</font></font></li>";
                                            html += "<li  id='Images_Price" + msg.data[i].id + "' ><font style='vertical-align:inherit;'><font class='in18price' style='vertical-align:inherit;'>价格</font></font></li>";
                                            html += "<li  id='Images_Description" + msg.data[i].id + "'><font style='vertical-align:inherit;'><font class='in18description' style='vertical-align:inherit;'>描叙</font></font></li>";
                                            html += "<li  id='Images" + msg.data[i].id + "'><font style='vertical-align:inherit;'><font class='in18picture' style='vertical-align:inherit;'>图片</font></font></li>";

                                            ul.innerHTML = html;
                                            $(".in18product").html($.i18n.prop('product'));
                                            $(".in18price").html($.i18n.prop('price'));
                                            $(".in18description").html($.i18n.prop('description'));
                                            $(".in18picture").html($.i18n.prop('picture'));

                                            //分隔符
                                            var fg = document.createElement("div");
                                            fg.setAttribute('class', 'cutoff_rule');
                                            div.appendChild(fg);

                                            var div2 = document.createElement("div");
                                            div2.setAttribute('class', 'productbody');
                                            div2.setAttribute('id', 'productbody' + msg.data[i].id);
                                            div.appendChild(div2);
                                            //左边放图片
                                            var div3 = document.createElement("div");
                                            div3.setAttribute('class', 'pic');
                                            div3.setAttribute('style', 'float:left;width:200px;height:200px;margin-top:30px;');
                                            div2.appendChild(div3);
                                            var img = "<img class='lazy-load' src= '" + msg.data[i].indexPicture + "' style='width:200px;height:200px;vertical-align:center' referrerPolicy='no-referrer'>";
                                            div3.innerHTML = img;
                                            //右边
                                            var div4 = document.createElement("div");
                                            div4.setAttribute('class', 'right');
                                            div2.appendChild(div4);
                                            //title
                                            var div5 = document.createElement("div");
                                            div5.setAttribute('class', 'title');
                                            div5.innerHTML = msg.data[i].productTitle;
                                            div4.appendChild(div5);
                                            //更改名称
                                            var div6 = document.createElement("div");
                                            div6.setAttribute('class', 'upNameText');
                                            div6.innerHTML = $.i18n.prop('updatetitle');
                                            div4.appendChild(div6);

                                            var input = document.createElement("input");
                                            input.setAttribute('type', 'text');
                                            input.setAttribute('id', 'update_title' + msg.data[i].id);
                                            input.setAttribute('class', 'upNameInput');
                                            input.setAttribute('value', msg.data[i].productTitle);
                                            //数据发生变化时更新
                                            input.setAttribute('onchange', "UpdateInfo('updatetitle'," + msg.data[i].id + " )");
                                            div4.appendChild(input);

                                            //类型
                                            var div7 = document.createElement("div");
                                            div7.setAttribute('class', 'select-type');
                                            var type = "<font style='vertical-align:inherit;'><font  class='changetype' style='vertical-align:inherit;font-size:14px;color:#666666;'>类型</font></font></br>";
                                            div7.innerHTML = type;
                                            div4.appendChild(div7);
                                            $(".changetype").html($.i18n.prop('type'));

                                            var input1 = document.createElement("input");
                                            input1.setAttribute('type', 'text');
                                            input1.setAttribute('class', 'input-type');
                                            input1.setAttribute('id', 'update_type' + msg.data[i].id);
                                            var type = msg.data[i].productType;
                                            if (msg.data[i].productType == null) {
                                                type = '';
                                            }
                                            input1.setAttribute('value', type);
                                            input1.setAttribute('placeholder', $.i18n.prop('Insert.Type.Here'));
                                            //数据发生变化时更新
                                            input1.setAttribute('onchange', "UpdateInfo('updatetype'," + msg.data[i].id + " )");
                                            div7.appendChild(input1);

                                            //标签
                                            var div8 = document.createElement("div");
                                            div8.setAttribute('class', 'select-lable');
                                            var lable = "<font style='vertical-align:inherit;'><font  class='changelable' style='vertical-align:inherit;font-size:14px;color:#666666;'>标签</font></font></br>";
                                            div8.innerHTML = lable;
                                            div4.appendChild(div8);
                                            $(".changelable").html($.i18n.prop('tags'));

                                            var input2 = document.createElement("input");
                                            input2.setAttribute('type', 'text');
                                            input2.setAttribute('class', 'input-lable');
                                            input2.setAttribute('id', 'update_label' + msg.data[i].id);

                                            var label = msg.data[i].label;
                                            if (msg.data[i].label == null) {
                                                label = '';
                                            }
                                            input2.setAttribute('value', label);
                                            input2.setAttribute('placeholder', $.i18n.prop('Separate.multiple.entries.with.commas'));
                                            //数据发生变化时更新
                                            input2.setAttribute('onchange', "UpdateInfo('updatelabel'," + msg.data[i].id + " )");
                                            div8.appendChild(input2);

                                            //下分隔符
                                            var fg1 = document.createElement("div");
                                            fg1.setAttribute('class', 'cutoff_rule_button');
                                            div.appendChild(fg1);

                                            //下部分
                                            var divbuttom = document.createElement("div");
                                            divbuttom.setAttribute('class', 'productbuttom');
                                            div.appendChild(divbuttom);

                                            //添加删除和推送按钮
                                            var budiv = document.createElement("div");
                                            budiv.setAttribute('class', 'pro');
                                            divbuttom.appendChild(budiv);

                                            var delinput = document.createElement("input");
                                            delinput.setAttribute('type', 'button');
                                            delinput.setAttribute('id', 'delproduct' + msg.data[i].id);
                                            delinput.setAttribute('class', 'deletepro');
                                            delinput.setAttribute('i18n_Text', 'deleteproduct');
                                            delinput.setAttribute('value', '删除商品');
                                            delinput.setAttribute('onclick', 'DelProduct(' + msg.data[i].id + ')');
                                            budiv.appendChild(delinput);
                                            $(".deletepro").val($.i18n.prop('deleteproduct'));

                                            if (YDHCustomer.Secret != null) {
                                                var pushInput = document.createElement("input");
                                                pushInput.setAttribute('type', 'button');
                                                pushInput.setAttribute('id', 'pushproduct' + msg.data[i].id);
                                                pushInput.setAttribute('class', 'pushpro');
                                                pushInput.setAttribute('value', '推送到商店');
                                                pushInput.setAttribute('onclick', 'PushProduct(' + msg.data[i].id + ')');
                                                budiv.appendChild(pushInput);
                                                $(".pushpro").val($.i18n.prop('pushpro'));
                                            }

                                            //li选中切换
                                            $(function () {
                                                var pircturelist = msg.data[i].pictureJson;
                                                var id = msg.data[i].id;
                                                var flag = 0;
                                                //点击价格,获取价格信息
                                                $("#Images_Price" + msg.data[i].id).click(function () {

                                                    $(this).addClass('select');
                                                    $("#productinfo" + id + " li").not($(this)).removeClass('select');
                                                    //获取价格信息
                                                    var productprice = new Object();
                                                    productprice.productId = id;
                                                    $.ajax({
                                                        type: "post",
                                                        contentType: "application/json",
                                                        url: BackgroundDomain + '/api/Product/QueryProductPriceInfo',
                                                        data: JSON.stringify(productprice),
                                                        success: function (data) {
                                                            document.getElementById("productbody" + id).innerHTML = "";
                                                            //添加表格头部
                                                            var pricehtml = "";
                                                            var pricediv = document.getElementById("productbody" + id);

                                                            var pricetopdiv = document.createElement("div");
                                                            pricetopdiv.setAttribute('style', 'height:48px;text-align:center;line-height:48px;');
                                                            pricediv.appendChild(pricetopdiv);

                                                            var priceul = document.createElement("ul");
                                                            priceul.setAttribute('style', 'height:48px;text-align:center;line-height:48px;');
                                                            priceul.setAttribute('class', 'table-header');
                                                            priceul.setAttribute('id', 'price' + data.data[0].productId);
                                                            pricetopdiv.appendChild(priceul);
                                                            pricehtml += "<li  class='head_font'style='width:20px;' ></li>";
                                                            pricehtml += "<li id='image" + id + "' class='head_font'style='width:calc((100% - 20px) * 0.15);' >图片<br></li>";
                                                            //将属性字段分隔成单个属性
                                                            var att = JSON.parse(data.data[0].attribute);
                                                            if (att != null) {
                                                                var attcount = Object.keys(att).length;
                                                                var width = Math.floor(34 / attcount);
                                                                for (var key in att) {
                                                                    pricehtml += "<li  class='head_font'style='width:calc((100% - 20px) * 0." + width + ");text-align:center;' ><input type = 'text' style='width:95%;max-width:320px;border:1px solid #EEEEEE;height:28px;border-radius: 16px;text-align:center;float:left;margin-top:9px;'    data-type='" + key + "' data-key='" + id + "'  value = '" + key + "' onchange='UpdateAttributetitel(this)'/></li>";
                                                                }
                                                            }
                                                            else {
                                                                pricehtml += "<li id='attribute" + id + "'  class='head_font'style='width:calc((100% - 20px) * 0.45);;text-align:center;float:left;margin-top:9px;' >property<br/></li>";

                                                            }
                                                            pricehtml += "<li class='head_font'style='width:10%;' >仓库<br></li>";
                                                            pricehtml += "<li id='currency" + id + "' class='head_font'style='width:calc((100% - 20px) * 0.15);' >币种<br></li>";
                                                            pricehtml += "<li id='cost" + id + "' class='head_font'style='width:calc((100% - 20px) * 0.1);'>成本<br></li>";
                                                            pricehtml += "<li id='in18price" + id + "' class='head_font'style='width:calc((100% - 20px) * 0.15);'>价格<br></li>";
                                                            priceul.innerHTML = pricehtml;
                                                            $("#image" + id).html($.i18n.prop('picture'));
                                                            $("#attribute" + id).html($.i18n.prop('attribute'));
                                                            $("#currency" + id).html($.i18n.prop('currency'));
                                                            $("#cost" + id).html($.i18n.prop('cost'));
                                                            $("#in18price" + id).html($.i18n.prop('price') + "&nbsp;&nbsp;<button type='button' class='layui-btn layui-btn-primary layui-btn-xs AllPrice ' data-price='" + id + "'>Change All</button> ");

                                                            var stockAddress = [];
                                                            $.ajax({
                                                                type: "post",
                                                                contentType: "application/json",
                                                                url: BackgroundDomain + '/api/Product/GetProProductStockAddressBySku',
                                                                data: JSON.stringify({ productId: id }),
                                                                async: false,
                                                                success: function (ret) {
                                                                    stockAddress = ret.data;
                                                                }
                                                            })

                                                            //循环数据添加主体部分
                                                            for (var i = 0; i < data.data.length; i++) {
                                                                var pricediv1 = document.createElement("div");
                                                                pricediv1.setAttribute('class', 'table-body');
                                                                pricediv.appendChild(pricediv1);

                                                                var priceul1 = document.createElement("ul");
                                                                /*  priceul1.setAttribute('class', 'table-body');*/
                                                                pricediv1.appendChild(priceul1);
                                                                var pricehtml1 = "";
                                                                pricehtml1 += "<li class='price_body' style='width:20px;'><label><input type='checkbox'  data-key='" + data.data[i].id + "' id='prchk" + data.data[i].id + "' onchange='Updatecheckvariant(this)'/></label></li>";
                                                                /*    pricehtml1 += "<li class='price_body' style='width:2%;'><i  class='active'  data-key='" + data.data[i].id + "' id='prchk" + data.data[i].id + "' onchange='Updatecheckvariant(this)'></i></li>";*/
                                                                pricehtml1 += "<li class='price_body'style='width:calc((100% - 20px) * 0.15);'><img src='" + data.data[i].pictureUrl + "' style='height:50px' referrerPolicy='no-referrer'><br></li>";
                                                                //将属性字段分隔成单个属性
                                                                var att1 = JSON.parse(data.data[i].attribute);
                                                                if (att1 != null) {
                                                                    var attcount1 = Object.keys(att1).length;
                                                                    var width1 = Math.floor(34 / attcount1);
                                                                    for (var key in att1) {
                                                                        pricehtml1 += "<li  class='price_body'style='width:calc((100% - 20px) * 0." + width1 + ");text-align:center;'>" +
                                                                            "<input type = 'text' class='layui-input' style='width:95%;max-width:320px;border-radius: 16px;text-align: center;float:left;'  data-type='" + key + "' data-key='" + data.data[i].id + "'  value = '" + att1[key] + "' onchange='UpdateAttribute(this)'/> <br/></li> ";
                                                                    }
                                                                } else {
                                                                    pricehtml1 += "<li  class='price_body'style='width:calc((100% - 20px) * 0.45);float:left;'><br/></li > "
                                                                }

                                                                var oen = " <option value ='0'>请选择仓库</option>";
                                                                if (stockAddress && stockAddress.length > 0) {
                                                                    var stocksku = stockAddress.filter(j => j.sku == data.data[i].sku);
                                                                    for (let index = 0; index < stocksku.length; index++) {
                                                                        if (stocksku[index].id == data.data[i].stockId) {
                                                                            oen += "<option value ='" + stocksku[index].id + "' selected = 'selected'>" + stocksku[index].address + "</option>";
                                                                        } else {
                                                                            oen += "<option value ='" + stocksku[index].id + "'>" + stocksku[index].address + "</option>";
                                                                        }
                                                                    }
                                                                }

                                                                pricehtml1 += "<li class='price_body' style='width:10%;'> <select class='layui-select' style='width:90%;'   data-key='" + data.data[i].id + "'  onchange='UpdateStock(this)' >" + oen + "<select> <br></li>";
                                                                pricehtml1 += "<li class='price_body'style='width:calc((100% - 20px) * 0.15);'>" + data.data[i].currency + "<br></li>";
                                                                pricehtml1 += "<li class='price_body'style='width:calc((100% - 20px) * 0.1);'>" + data.data[i].cost + "<br></li>";
                                                                var onchange = "UpdatePrice(" + data.data[i].id + ")";
                                                                pricehtml1 += "<li class='price_body'style='width:calc((100% - 20px) * 0.15);'><input type='text' style='border-radius: 16px;text-align: center;width:calc(100% - 2px);' class='layui-input' data-price='" + id + "' value='" + data.data[i].price + "' id='update_price" + data.data[i].id + "' onchange='" + onchange + "'><br></li>";
                                                                priceul1.innerHTML = pricehtml1;

                                                                if (data.data[i].ischeck == "0") {
                                                                    document.getElementById("prchk" + data.data[i].id).checked = true;
                                                                }


                                                            }
                                                        }
                                                    })
                                                });


                                                //点击产品标题,获取标题信息
                                                $("#Images_Title" + msg.data[i].id).click(function () {

                                                    $(this).addClass('select');
                                                    $("#productinfo" + id + " li").not($(this)).removeClass('select');
                                                    //获取标题信息
                                                    var producttitle = new Object();
                                                    /*producttitle.productId = id;*/
                                                    producttitle.page = 1;
                                                    producttitle.limit = 10;
                                                    producttitle.dto = { id: id }
                                                    $.ajax({
                                                        type: "post",
                                                        contentType: "application/json",
                                                        url: BackgroundDomain + '/api/Product/QueryImportProductList',
                                                        data: JSON.stringify(producttitle),
                                                        success: function (data) {
                                                            document.getElementById("productbody" + id).innerHTML = "";
                                                            var titlediv = document.getElementById("productbody" + id);

                                                            //左边放图片
                                                            var titlediv3 = document.createElement("div");
                                                            titlediv3.setAttribute('class', 'pic');
                                                            titlediv3.setAttribute('style', 'float:left;width:200px;height:200px;margin-top:30px;');
                                                            titlediv.appendChild(titlediv3);
                                                            var img = "<img class='lazy-load' src= '" + data.data[0].indexPicture + "' style='width:200px;height:200px;vertical-align:center' >";
                                                            titlediv3.innerHTML = img;
                                                            //右边
                                                            var titlediv4 = document.createElement("div");
                                                            titlediv4.setAttribute('class', 'right');
                                                            titlediv.appendChild(titlediv4);
                                                            //title
                                                            var titlediv5 = document.createElement("div");
                                                            titlediv5.setAttribute('class', 'title');
                                                            titlediv5.innerHTML = data.data[0].productTitle;;
                                                            titlediv4.appendChild(titlediv5);
                                                            //更改名称
                                                            var titlediv6 = document.createElement("div");
                                                            titlediv6.setAttribute('class', 'upNameText');
                                                            titlediv6.innerHTML = $.i18n.prop('updatetitle');
                                                            titlediv4.appendChild(titlediv6);


                                                            var titleinput = document.createElement("input");
                                                            titleinput.setAttribute('type', 'text');
                                                            titleinput.setAttribute('id', 'update_title' + data.data[0].id);
                                                            titleinput.setAttribute('class', 'upNameInput');
                                                            titleinput.setAttribute('value', data.data[0].productTitle);
                                                            //数据发生变化时更新
                                                            titleinput.setAttribute('onchange', "UpdateInfo('updatetitle'," + data.data[0].id + " )");
                                                            titlediv4.appendChild(titleinput);


                                                            //类型
                                                            var titlediv7 = document.createElement("div");
                                                            titlediv7.setAttribute('class', 'select-type');
                                                            var type = "<font style='vertical-align:inherit;'><font  class='changetype' style='vertical-align:inherit;font-size:14px;color:#666666;'>类型</font></font></br>";
                                                            titlediv7.innerHTML = type;
                                                            titlediv4.appendChild(titlediv7);
                                                            $(".changetype").html($.i18n.prop('type'));

                                                            var titleinput1 = document.createElement("input");
                                                            titleinput1.setAttribute('type', 'text');
                                                            titleinput1.setAttribute('class', 'input-type');
                                                            titleinput1.setAttribute('id', 'update_type' + data.data[0].id);
                                                            var type = data.data[0].productType;
                                                            if (data.data[0].productType == null) {
                                                                type = '';
                                                            }
                                                            titleinput1.setAttribute('value', type);
                                                            titleinput1.setAttribute('placeholder', $.i18n.prop('Insert.Type.Here'));
                                                            //数据发生变化时更新
                                                            titleinput1.setAttribute('onchange', "UpdateInfo('updatetype'," + data.data[0].id + " )");
                                                            titlediv7.appendChild(titleinput1);

                                                            //标签
                                                            var titlediv8 = document.createElement("div");
                                                            titlediv8.setAttribute('class', 'select-lable');
                                                            var lable = "<font style='vertical-align:inherit;'><font class='changelable' style='vertical-align:inherit;font-size:14px;color:#666666;'>标签</font></font></br>";
                                                            titlediv8.innerHTML = lable;
                                                            titlediv4.appendChild(titlediv8);
                                                            $(".changelable").html($.i18n.prop('tags'));

                                                            var titleinput2 = document.createElement("input");
                                                            titleinput2.setAttribute('type', 'text');
                                                            titleinput2.setAttribute('class', 'input-lable');
                                                            titleinput2.setAttribute('id', 'update_label' + data.data[0].id);
                                                            var label = data.data[0].label;
                                                            if (data.data[0].label == null) {
                                                                label = '';
                                                            }
                                                            titleinput2.setAttribute('value', label);
                                                            titleinput2.setAttribute('placeholder', $.i18n.prop('Separate.multiple.entries.with.commas'));
                                                            //数据发生变化时更新
                                                            titleinput2.setAttribute('onchange', "UpdateInfo('updatelabel'," + data.data[0].id + " )");
                                                            titlediv8.appendChild(titleinput2);
                                                        }
                                                    })


                                                });

                                                //点击产品描述,,获取描述信息
                                                $("#Images_Description" + msg.data[i].id).click(function () {

                                                    $(this).addClass('select');
                                                    $("#productinfo" + id + " li").not($(this)).removeClass('select');

                                                    var productdescription = new Object();
                                                    productdescription.productId = id;
                                                    $.ajax({
                                                        type: "post",
                                                        contentType: "application/json",
                                                        url: BackgroundDomain + '/api/Product/QueryProductDescriptionInfo',
                                                        data: JSON.stringify(productdescription),
                                                        success: function (data) {
                                                            document.getElementById("productbody" + id).innerHTML = "";
                                                            var descriptiondiv = document.getElementById("productbody" + id);
                                                            var descriptiondiv1 = document.createElement("div");
                                                            descriptiondiv1.setAttribute('id', 'Description' + data.dto.id);
                                                            descriptiondiv1.setAttribute('class', 'Description');
                                                            descriptiondiv.appendChild(descriptiondiv1);
                                                            //富文本编辑器
                                                            var E = window.wangEditor;
                                                            const editor = new E('#Description' + data.dto.id)
                                                            if (lang == "en_us") {
                                                                editor.config.lang = "en";
                                                                editor.i18next = window.i18next;
                                                            }
                                                            var change = 0;
                                                            editor.config.onchange = (html) => {
                                                                if (change != 0) {
                                                                    /*console.log(`获取到的富文本数据:${html}`);*/
                                                                    UpdateDescription(data.dto.id, html);
                                                                }
                                                                change = 1;
                                                            };
                                                            editor.create()
                                                            editor.txt.html(data.dto.content)
                                                        }

                                                    })
                                                });

                                                //点击产品图片
                                                $("#Images" + msg.data[i].id).click(function () {
                                                    // 这里能获取到当前点击的li标签当前的value值
                                                    $(this).addClass('select');
                                                    $("#productinfo" + id + " li").not($(this)).removeClass('select');
                                                    var productpicture = new Object();
                                                    productpicture.productId = id;

                                                    var picture = pircturelist.replace('[', '').replace(']', '').split(",");


                                                    document.getElementById("productbody" + id).innerHTML = "";
                                                    var picturehtml = "";
                                                    var picturediv = document.getElementById("productbody" + id);
                                                    var pictureul1 = document.createElement("ul");
                                                    picturediv.appendChild(pictureul1);


                                                    ////循环数据添加主体部分
                                                    //for (var i = 0; i < picture.length; i++) {
                                                    //    picturehtml += "<li class='pirturebody'style='width:200px;;float:left'><i class='layui-icon icon-a-check'></i> <img src=" + picture[i] + " style='width:200px;height:200px;'></li>";
                                                    //}
                                                    //pictureul1.innerHTML = picturehtml;

                                                    $.ajax({
                                                        type: "post",
                                                        contentType: "application/json",
                                                        url: BackgroundDomain + '/api/Product/QueryProductImagesInfo',
                                                        data: JSON.stringify(productpicture),
                                                        success: function (data) {
                                                            if (data.data) {
                                                                //循环数据添加主体部分
                                                                for (var i = 0; i < data.data.length; i++) {
                                                                    if (data.data[i].isVisible == 0) {
                                                                        picturehtml += "<li id= 'pirture" + data.data[i].id + "' data-key='" + data.data[i].id + "' class='pirturebody'style='width:150px;;float:left'onclick='changeImageState(this)' ><i class='layui-icon icon-a-check' id='icon" + data.data[i].id + "'></i> <img src=" + data.data[i].pictureUrl + " style='width:150px;height:150px;'></li>";
                                                                    }
                                                                }
                                                                pictureul1.innerHTML = picturehtml;
                                                            }

                                                        }

                                                    })


                                                });
                                            })


                                        }
                                        layer.close(myMsg);//手动关闭
                                    }
                                })
                            }
                        });
                    }
                })
            }

            i18n.loadProperties(id);

            // $("#btnsearch").click(function (data) {
            //     var result = document.getElementById("productTitle").value;

            //     if ($.isEmptyObject(result) != true) {
            //         SerchproductInfo.productTitle = result;
            //     }
            //     QueryImportProduct(count, SerchproductInfo);
            // })

            // 监听搜索操作
            form.on('submit(data-search-btn)', function (data) {
                //var obj = new Object();
                //obj.productTitle = $("#productTitle").val();
                var result = JSON.stringify(data.field);
                obj = $.parseJSON(result);
                if ($.isEmptyObject(obj.productTitle) != true) {
                    SerchproductInfo.productTitle = obj.productTitle;
                }
                QueryImportProduct(count, SerchproductInfo);
                return false;
            })


            window.btnSearch = () => {
                //var result = document.getElementById("productTitle").value;
                //var count;
                //var SerchproductInfo = new Object();

                //if ($.isEmptyObject(result) != true) {
                //    SerchproductInfo.productTitle = result;
                //}
                // QueryImportProduct(count, SerchproductInfo);
            };
        })

        //修改变体库存
        function UpdateStock(input) {
            var priceInfo = new Object();
            priceInfo.id = $(input).attr("data-key");
            priceInfo.stockId = $(input).val();
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/UpdateProductStock',
                data: JSON.stringify(priceInfo),
                success: function (data) {
                    if (data.code > 0) {
                        layer.msg("修改仓库成功!")
                    }
                }
            })
        }


        ////提交增删改数据
        function UpdateInfo(type, id) {
            console.log(type + id);
            //修改标题
            if (type == "updatetitle") {
                var change = document.getElementById('update_title' + id).value;
                var productInfo = new Object();
                productInfo.id = id;
                productInfo.productTitle = change;
                $.ajax({
                    type: "post",
                    contentType: "application/json",
                    url: BackgroundDomain + '/api/Product/UpdateProductInfo',
                    data: JSON.stringify(productInfo),
                    success: function (data) {
                        if (data.code == 1) {
                            layer.msg($.i18n.prop('The.update.is.successful'))
                        }
                    }
                })
            }

            //修改类型
            if (type == "updatetype") {
                var change = document.getElementById('update_type' + id).value;
                var productInfo = new Object();
                productInfo.id = id;
                productInfo.productType = change;
                $.ajax({
                    type: "post",
                    contentType: "application/json",
                    url: BackgroundDomain + '/api/Product/UpdateProductInfo',
                    data: JSON.stringify(productInfo),
                    success: function (data) {
                        if (data.code == 1) {
                            layer.msg($.i18n.prop('The.update.is.successful'))
                        }
                    }
                })
            }

            //修改标签
            if (type == "updatelabel") {
                var change = document.getElementById('update_label' + id).value;
                var productInfo = new Object();
                productInfo.id = id;
                productInfo.label = change;
                $.ajax({
                    type: "post",
                    contentType: "application/json",
                    url: BackgroundDomain + '/api/Product/UpdateProductInfo',
                    data: JSON.stringify(productInfo),
                    success: function (data) {
                        if (data.code == 1) {
                            layer.msg($.i18n.prop('The.update.is.successful'))
                        }
                    }
                })
            }

        }

        ////修改价格
        function UpdatePrice(id) {
            console.log("点击价格事件" + id);
            var idname = "update_price" + id;
            var change = document.getElementById(idname).value;
            /*    $(idname).val();*/
            /*   document.getElementById('price' + id).value;*/
            var priceInfo = new Object();
            priceInfo.id = id;
            priceInfo.price = Number(change);
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/UpdateProductPrice',
                data: JSON.stringify(priceInfo),
                success: function (data) {
                    if (data.code == 1) {
                        layer.msg($.i18n.prop('The.update.is.successful'))
                    }
                }
            })
        }
        // 修改商品所有变体价格
        $(document).on('click', '.AllPrice', function () {

            var id = $(this).attr("data-price");

            layer.prompt({ title: 'Please enter the amount', formType: 3 }, function (pass, index) {

                layer.close(index);

                if (!pass || isNaN(pass)) {
                    layer.msg("You can only enter numbers!");
                    return;
                }
                var priceInfo = new Object();
                priceInfo.ProductId = id;
                priceInfo.price = Number(pass);
                $.ajax({
                    type: "post",
                    contentType: "application/json",
                    url: BackgroundDomain + '/api/Product/UpdateProductPrice',
                    data: JSON.stringify(priceInfo),
                    success: function (data) {
                        if (data.code == 1) {
                            $("[data-price='" + id + "']").val(pass);
                            layer.msg($.i18n.prop('The.update.is.successful'))
                        }
                    }
                })
            });



        });


        //修改属性
        function UpdateAttribute(input) {
            var priceInfo = new Object();
            priceInfo.id = $(input).attr("data-key");
            priceInfo.AttrKey = $(input).attr("data-type");
            priceInfo.AttrValue = $(input).val();
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/UpdateProductAttribute',
                data: JSON.stringify(priceInfo),
                success: function (data) {
                    if (data.data > 0) {
                        layer.msg($.i18n.prop('The.update.is.successful'))
                    }
                }
            })
        }
        //修改属性标题 UpdateAttributetitel
        function UpdateAttributetitel(input) {
            var Attributetitel = new Object();
            Attributetitel.ProductId = $(input).attr("data-key");
            Attributetitel.OldAttributeName = $(input).attr("data-type");
            Attributetitel.NewAttributeName = $(input).val();
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/ModifyProductAttriName',
                data: JSON.stringify(Attributetitel),
                success: function (data) {
                    if (data.data > 0) {
                        layer.msg($.i18n.prop('The.update.is.successful'), {

                        })
                    }
                }
            })
        }
        //修改变体是否选中状态
        function Updatecheckvariant(check) {
            var id = $(check).attr("data-key");
            var checked = check.checked ? 0 : 1;
            var pro = new Object();
            pro.id = id;
            pro.Ischeck = checked;
            /*            alert(check.checked);*/
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/ModifyProductVariantCheck',
                data: JSON.stringify(pro),
                success: function (data) {
                    if (data.data > 0) {
                        layer.msg($.i18n.prop('The.update.is.successful'))
                    }
                    else {
                        $(check).prop("checked", true);
                        layer.alert($.i18n.prop('variant.check.update.is.failure'), {
                            closeBtn: 1  // 是否显示关闭按钮
                            , title: "hint"
                            , btn: ['confirm']
                            , style: {
                                "background-color": "#FFD401;"
                            }
                        })
                    }
                }
            })

        }

        //当大产品上面的选中框发生改变时事件
        function UpdatecheckProduct(check) {
            var id_array = new Array();
            $('input[class="ProductChk"]:checked').each(function () {
                id_array.push($(this).attr("data-key"));//向数组中添加元素
            });
            var idstr = id_array.join(',');//将数组元素连接起来以构建一个字符串
            var num = count(id_array);
            if (Number(num) > 0) {
                var totalDiv = document.getElementById("total");
                totalDiv.style.display = "inline"
            }
            else {
                var totalDiv = document.getElementById("total");
                totalDiv.style.display = "none"
            }

            var TotalSelect = document.getElementById("tatalSelect");

            TotalSelect.html(num + " Select")
        }

        ////修改描叙
        function UpdateDescription(id, change) {
            console.log(change);
            var DescriptionInfo = new Object();
            DescriptionInfo.id = id;
            DescriptionInfo.content = change;
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/UpdateProductDescription',
                data: JSON.stringify(DescriptionInfo),
                success: function (data) {
                    if (data.code == 1) {
                        layer.msg($.i18n.prop('The.update.is.successful'))
                    }
                }
            })
        }
        //删除产品
        function DelProduct(id) {
            var product = new Object();
            product.id = id;
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/DeleteProduct',
                data: JSON.stringify(product),
                success: function (data) {
                    if (data.code == 1) {
                        layer.msg($.i18n.prop('Deleted.successfully'));
                        var product = document.getElementById("product" + id);
                        if (product != null)
                            product.parentNode.removeChild(product);

                    }
                }
            })
        }
        //推送到商店
        function PushProduct(id) {
            var loading = layer.load(0, {
                shade: false,
                time: 60 * 1000
            });
            var shopifyId = parseInt($("#selectshop").attr("value"));
            console.log("shopifyId" + shopifyId);
            if (!shopifyId || shopifyId == "BingShop") {
                layui.use(['i18n', 'app', 'layer', 'form', 'element', 'laypage'], function () {
                    $ = layui.jquery;
                    app = layui.app;
                    var layer = layui.layer,
                        message = layui.message;
                    message.run("Select at least one Shop Name!", "", "error");
                });
                layer.close(loading);
                return false;
            }

            var product = new Object();
            product.id = id;
            product.shopifyId = shopifyId;
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/PushShopifyProduct',
                data: JSON.stringify(product),
                success: function (data) {
                    layer.close(loading);
                    if (data.code == 1) {
                        /*       layer.msg($.i18n.prop('Successful.push'));*/
                        layui.use(['i18n', 'app', 'layer', 'form', 'element', 'laypage'], function () {
                            $ = layui.jquery;
                            app = layui.app;
                            var layer = layui.layer,
                                message = layui.message;
                            message.run($.i18n.prop('Push.Succeeded'), $.i18n.prop('Successful.push'));
                        });
                        var product = document.getElementById('product' + id);
                        product.style.display = "none";
                    }
                    else {
                        layer.close(loading);
                        layui.use(['i18n', 'app', 'layer', 'form', 'element', 'laypage'], function () {
                            $ = layui.jquery;
                            app = layui.app;
                            var layer = layui.layer,
                                message = layui.message;
                            message.run("Error", "", "error");
                        });
                    }
                }
            })
        }
        //删除所有选中产品
        function DelAllProduct() {
            var id_array = new Array();
            $('input[class="ProductChk"]:checked').each(function () {
                id_array.push($(this).attr("data-key"));//向数组中添加元素
            });
            var idstr = id_array.join(',');//将数组元素连接起来以构建一个字符串
            var data = String(idstr);
            var product = new Object();
            product.Ids = data;

            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/DeleteAllChkProduct',
                data: JSON.stringify(product),
                success: function (data) {
                    if (data.code == 1) {
                        layer.msg($.i18n.prop('Deleted.successfully'));

                        id_array.forEach(function (value) {
                            var product = document.getElementById("product" + value);
                            if (product != null)
                                product.parentNode.removeChild(product);
                        });
                        var totalDiv = document.getElementById("total");
                        totalDiv.style.display = "none"
                    }
                }
            })
        }
        //推送所有选中产品
        function PushAllProduct() {
            var loading = layer.load(0, {
                shade: false,
                time: 60 * 1000
            });
            var shopifyId = parseInt($("#selectshop").attr("value"));

            console.log("shopifyId" + shopifyId);
            if (!shopifyId || shopifyId == "BingShop") {
                layui.use(['i18n', 'app', 'layer', 'form', 'element', 'laypage'], function () {
                    $ = layui.jquery;
                    app = layui.app;
                    var layer = layui.layer,
                        message = layui.message;
                    message.run("Select at least one Shop Name!", "", "error");
                });
                layer.close(loading);
                return false;
            }


            var id_array = new Array();
            $('input[class="ProductChk"]:checked').each(function () {
                id_array.push($(this).attr("data-key"));//向数组中添加元素
            });
            var idstr = id_array.join(',');//将数组元素连接起来以构建一个字符串
            var data = String(idstr);
            var product = new Object();
            product.Ids = data;
            product.shopifyId = shopifyId;

            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/PushAllChkShopifyProduct',
                data: JSON.stringify(product),
                success: function (data) {
                    layer.close(loading);
                    if (data.code == 1) {
                        /* layer.msg($.i18n.prop('Successful.push'));*/
                        layui.use(['i18n', 'app', 'layer', 'form', 'element', 'laypage'], function () {
                            $ = layui.jquery;
                            app = layui.app;
                            var layer = layui.layer,
                                message = layui.message;
                            message.run($.i18n.prop('Push.Succeeded'), $.i18n.prop('Successful.push'));
                        });
                        id_array.forEach(function (value) {
                            var product = document.getElementById("product" + value);
                            if (product != null)
                                product.parentNode.removeChild(product);
                        });
                        var totalDiv = document.getElementById("total");
                        totalDiv.style.display = "none"
                    }
                    else {
                        layer.close(loading);
                        layui.use(['i18n', 'app', 'layer', 'form', 'element', 'laypage'], function () {
                            $ = layui.jquery;
                            app = layui.app;
                            var layer = layui.layer,
                                message = layui.message;
                            message.run("Error", "", "error");
                        });
                    }
                },
                error: function (sre) {
                    layer.close(loading);
                    layui.use(['i18n', 'app', 'layer', 'form', 'element', 'laypage'], function () {
                        $ = layui.jquery;
                        app = layui.app;
                        var layer = layui.layer,
                            message = layui.message;
                        message.run("Error", "", "error");
                    });
                }


            })
        }
        //跳转到查找产品界面
        function ToAddProduct() {
            var tabId = "/client/FindPlatFormProduct.html";
            title = "Find products";
            var isexit = miniTab.check(tabId, true);
            if (!isexit) {
                parent.layui.element.tabAdd('layuiminiTab', {
                    title: '<span class="layuimini-tab-active"></span><span>' + title + '</span><i class="layui-icon layui-unselect layui-tab-close">ဆ</i>' //用于演示
                    , content: '<iframe width="100%" height="100%" frameborder="no" border="0" marginwidth="0" marginheight="0"   src="' + tabId + '"></iframe>'
                    , id: tabId
                });
            }
            parent.layui.element.tabChange('layuiminiTab', tabId);
        }
        //计算数组数量
        function count(obj) {
            var objType = typeof obj;
            if (objType == "string") {
                return obj.length;
            } else if (objType == "object") {
                var objLen = 0;
                for (var i in obj) {
                    objLen++;
                }
                return objLen;
            }
            return false;
        }
        //勾选批量操作的checkbox控制全选或全不选
        function checkAllChange(input) {
            if (input.checked) {
                $("input[class='ProductChk']").prop('checked', true);

                var id_array = new Array();
                $('input[class="ProductChk"]:checked').each(function () {
                    id_array.push($(this).attr("data-key"));//向数组中添加元素
                });
                var num = count(id_array);
                var TotalSelect = document.getElementById("tatalSelect");
                TotalSelect.innerHTML = num + " Select";

            } else {
                $("input[class='ProductChk']").prop('checked', false);
                var TotalSelect = document.getElementById("tatalSelect");
                TotalSelect.innerHTML = 0 + " Select";
            }
        };
        //改变图片状态
        function changeImageState(image) {
            var imageId = $(image).attr("data-key");
            console.log(imageId)
            var productpicture = new Object();
            productpicture.id = imageId;
            $.ajax({
                type: "post",
                contentType: "application/json",
                url: BackgroundDomain + '/api/Product/UpdateProImageStatus',
                data: JSON.stringify(productpicture),
                success: function (data) {
                    if (data.dto) {
                        if (data.dto.isVisible == 0) {
                            $("#icon" + imageId).attr("style", "display:block;");
                            $("#pirture" + imageId).attr("style", "border:2px solid #673AB7");
                        }
                        else {
                            /*           var icon = document.getElementById();*/
                            $("#icon" + imageId).attr("style", "display:none;");
                            $("#pirture" + imageId).attr("style", "border:2px solid #DDD");
                        }
                    }
                }
            })

        }


        //点击选择框
        $(document).on('click', 'div.model-select-box div.model-select-text', function () {
            var $box = $('div.model-select-box');
            var $option = $('ul.model-select-option', $box);
            var $txt = $('div.model-select-text', $box);
            var speed = 10;
            var $bg = $('b.bg1', $box)
            $('div.model-select-box ul.model-select-option').not($(this).siblings('ul.model-select-option')).slideUp(speed, function () {
            });
            var temp1 = $("div.model-select-box ul.model-select-option").is(":visible");
            if (temp1) {

                $(this).siblings('ul.model-select-option').slideUp(speed, function () {
                    selectindex = 1;
                });
            }
            else {
                $(this).siblings('ul.model-select-option').slideToggle(speed, function () {
                    selectindex = 1;
                });
            }


            $option.find('li').each(function (index, element) {
                var selectpriceid = $('#selectshop').attr("shopify-id");
                var shopifyid = $(this).attr("shopify-id");
                if (selectpriceid == shopifyid) {
                    $(this).addClass('selected').siblings('li').removeClass('selected');
                }

                if ($(this).hasClass('selected')) {
                    $(this).parent('.model-select-option').siblings('.model-select-text').html('<img class="shoplogo" src="../../../images/shop.png" />' + $(this).text())
                }
                //$("#cli").one("click", function () {
                //    alert(count++);
                //});

                $(this).off("click").on("click", function () {
                    if ($(this).attr('shopify-id') == "BingShop") {
                        /* window.open('https://apps.shopify.com/Anderdrop-dropshipping?source=Anderdrop').location;*/
                        layer.open({
                            title: "Connect to store",
                            type: 2,
                            shade: 0.2,
                            shadeClose: true,
                            area: ['520px', '410px'],
                            content: '/client/Customer/BindShop.html',
                        });
                        $(this).parent().siblings('div.model-select-text').html('<img class="shoplogo" src="../../../images/button/add.png" />' + $(this).text());
                    }
                    else {
                        $(this).parent().siblings('div.model-select-text').html('<img class="shoplogo" src="../../../images/shop.png" />' + $(this).text());
                    }


                    $(this).parent().siblings('div.model-select-text').attr('value', $(this).attr('shopify-id'));
                    $option.slideUp(speed, function () {
                    });
                    $(this).addClass('selected').siblings('li').removeClass('selected');


                    selectindex = 0;

                    return false;
                })

                $(this).on('mouseover', function () {
                    $(this).addClass('selected').siblings('li').removeClass('selected');
                })

            })
        });


        ////点击除下拉框外的文档，隐藏所有下拉
        $(document).on('click', 'div.model-select-box ', function () {
            var $box = $('div.model-select-box');
            var $option = $('ul.model-select-option', $box);
            var $txt = $('div.model-select-text', $box);
            var speed = 10;
            var $bg = $('b.bg1', $box)
            ////点击文档，隐藏所有下拉
            $('body').not($(this)).bind('click', function () {
                $option.slideUp(speed, function () {
                });
            })


        });

        function btnSearch() {
            var result = document.getElementById("productTitle").value;
            var count;
            var SerchproductInfo = new Object();

            if ($.isEmptyObject(result) != true) {
                SerchproductInfo.productTitle = result;
            }
            QueryImportProduct(count, SerchproductInfo);
        };

    </script>

</body>

</html>
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Login</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css?v=20220525" media="all">
    <link rel="stylesheet" href="../../css/MkLogin.css?v=20220525" media="all">
    <link rel="stylesheet" href="/lib/layui-v2.6.3/font/font/iconfont.css?v=20220525" media="all">
</head>

<body>
    <div class="container">
        <div class="top">
            <img src="../../images/Marketing/MKLogin.png" />
        </div>
        <div class="admin-login-background">
            <div class="layui-form login-form" id="define">
                <div class="LoginText"> Login</div>
                <div class="line-text">E-mail</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-yingxiao-9-E-mail" for="email" id="icon-email"></label>
                    <input type="text" name="email" id="email" lay-verify="required|account" placeholder="Email address"
                        autocomplete="off" class="layui-input">
                </div>
                <div class="line-text">Password</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-a-yingxiao-11-Setpassword" for="password" id="icon-pwd"></label>
                    <input type="password" name="pwd" id="pwd" lay-verify="required|password" placeholder="Password"
                        autocomplete="off" class="layui-input">
                </div>
                <div>
                    <label class="botLable" i18n_Text="login.Label.ForgetPwd.Text"
                        style="color: #999999; cursor: pointer; " id="up_psd">Forget Password?</label>
                    <label class="botLable" i18n_Text="login.button.Reg.Text"
                        style="float: right; margin-right: 30px; color: #3399FF; cursor: pointer; " id="Reg">Sign
                        up</label>
                </div>
                <button class="layui-btn layui-btn layui-btn-normal layui-btn-fluid determine">Log in</button>
            </div>

            <div class="layui-form login-form" id="register" style="display:none">
                <div class="line-text">Name</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-yingxiao-8-Name" id="icon-reg-name"></label>
                    <input type="text" id="RegName" name="RegName" lay-verify="required|account" autocomplete="off"
                        class="layui-input" placeholder="Username">
                </div>
                <div class="line-text">E-mail</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-yingxiao-9-E-mail" id="icon-reg-email"></label>
                    <input i18n_Attr="placeholder:login.input.username.placeholder;" type="text" id="RegEmail"
                        name="RegEmail" lay-verify="required|account" autocomplete="off" class="layui-input"
                        placeholder="Email address">
                    <span id="regSendCode"
                        style="font-size: 28px; font-family: PingFang SC; font-weight: 400; position: absolute; top: 20px; right: 30px; color: #3399FF; "
                        onclick="SendCode(this)">Send code</span>
                </div>
                <div class="line-text">Code</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-yingxiao-10-Code" id="icon-reg-code"></label>
                    <input type="text" name="RegCode" id="RegCode" lay-verify="required|password" autocomplete="off"
                        class="layui-input" placeholder="Verification code">
                </div>
                <div class="line-text">Set password</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-a-yingxiao-11-Setpassword" id="icon-reg-psd"></label>
                    <input type="password" name="RegPsd" placeholder="Password" autocomplete="off"
                        lay-verify="required|captcha" class="layui-input" id="RegPsd">
                </div>
                <div class="line-text">Your business</div>
                <div class="layui-form-item">
                    <div class="layui-input-inline"> </div>
                    <label class="layui-icon icon-a-yingxiao-12-Yourbusiness" style="z-index:999;"
                        id="icon-reg-business"></label>
                    <select name="BusinessName" is="template" lay-verify="required" class="select" id="select"
                        lay-filter="type">
                        <option value="">Please select</option>
                        <option value="A">Shop technical services</option>
                        <option value="B">Shop owner</option>
                        <option value="C">Gulu</option>
                        <option value="D">Shop trainer</option>
                        <option value="E">Freelance</option>
                    </select>

                </div>
                <div>
                    <label id="login" class="botLable"
                        style="float: right; margin-right: 30px; color: #3399FF; cursor: pointer; ">Log in</label>
                </div>
                <div class="layui-form-item">
                    <button class="layui-btn layui-btn layui-btn-normal layui-btn-fluid register">Sign up</button>
                </div>

            </div>



            <div class="layui-form login-form" id="updatePsd" style="display:none">
                <div class="LoginText">Forgot password</div>
                <div class="line-text">E-mail</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-yingxiao-9-E-mail" id="icon-up-email"></label>
                    <input type="text" name="up_Emial" id="up_Emial" lay-verify="required|account" autocomplete="off"
                        class="layui-input" placeholder="E-mail">
                    <span id="upSendCode"
                        style="font-size: 28px; font-family: PingFang SC; font-weight: 400; position: absolute; top: 20px; right:30px; color: #3399FF; "
                        onclick="SendCode(this)">Send code</span>
                </div>
                <div class="line-text">Code</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-yingxiao-10-Code" id="icon-up-code"></label>
                    <input placeholder="Verification code" type="text" name="up_code" id="up_code"
                        lay-verify="required|password" autocomplete="off" class="layui-input">
                </div>
                <div class="line-text">Confirm password</div>
                <div class="layui-form-item">
                    <label class="layui-icon icon-a-yingxiao-11-Setpassword" id="icon-up-psd"></label>
                    <input type="password" name="up_psd" autocomplete="off" lay-verify="required|captcha"
                        class="layui-input" id="up_Psd" placeholder="Password">
                </div>
                <div> <label id="bk_login" class="botLable"
                        style="float: right; margin-right: 30px; color: #3399FF; cursor: pointer; ">Log in</label></div>
                <div class="layui-form-item">
                    <button style="color: #333333; font-size: 16px; font-family: Arial;"
                        class="layui-btn layui-btn layui-btn-normal layui-btn-fluid confirm">Log in</button>
                </div>


            </div>
        </div>
    </div>
    <script src="/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="/lib/md5.js"></script>
    <script src="/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
    <script src="/lib/jq-module/jquery.particleground.min.js" charset="utf-8"></script>

    <script src="/js/lay-config.js"></script>
    <script src="/js/lay-module/Message/Message.js?v=2" charset="utf-8"></script>
    <script type="text/javascript">
        var id = "en_us";
        layui.use(['form'], function () {
            var
                form = layui.form,
                i18n = layui.i18n,
                layer = layui.layer;

            // 拦截异常信息提醒
            $.ajaxSetup({
                complete: function (err) {
                    if (err.status == 400) {
                        layui.layer.msg(err.responseJSON.message, { icon: 2, time: 3000, shade: 0.4 });
                    }
                }
            });
            var YDHMarketing = layui.data('YDH-Marketing');

            form.on('select(type)', function () {
                var value = $('#select').find('option:selected').val();
                if (value == "") {
                    $("#icon-reg-business").removeClass("icon");
                }
            });

            //如果登录时用户框有默认值则图标颜色变为相应的填入值的颜色
            var emailvalue = $('#email').val()
            if (emailvalue != "") {
                $("#icon-email").addClass("icon");
            }
            //如果登录时密码框有默认值则图标颜色变为相应的填入值的颜色
            var pwdvalue = $('#pwd').val()
            if (pwdvalue != "") {
                $("#icon-pwd").addClass("icon");
            }

            // 跳转注册
            $("#Reg").click(function () {
                $("#define").hide();
                $("#register").show();
                $("#updatePsd").hide();
            });
            // 跳转登录
            $("#login").click(function () {
                $("#define").show();
                $("#register").hide();
                $("#updatePsd").hide();
            });
            // 跳转修改密码
            $("#up_psd").click(function () {
                $("#define").hide();
                $("#register").hide();
                $("#updatePsd").show();
            });
            //从修改密码界面跳转返回登录
            $("#bk_login").click(function () {
                $("#define").show();
                $("#register").hide();
                $("#updatePsd").hide();
            });

            // 登录
            $(document).on('click', '.determine', function () {

                var email = $("#email").val();
                if (!email) {
                    layer.msg('Email address cannot be empty! ', { icon: 5, time: 3000, shade: 0.4 });
                    return false;
                }
                var pwd = $("#pwd").val();
                if (!pwd) {
                    layer.msg('Password cannot be empty! ', { icon: 5, time: 3000, shade: 0.4 });
                    return false;
                }

                var timestamp = new Date().getTime();
                var Encrypt = $.md5(email + $.md5(pwd) + timestamp);
                $.ajax({
                    type: "post",
                    url: BackgroundDomain + "/api/Login/MarketingLogin",
                    contentType: "application/json;",
                    data: JSON.stringify({ "Email": email, "TimeStamp": timestamp, "Pw": Encrypt }),
                    dataType: "json",
                    success: function (sre) {
                        if (!sre) {
                            changeImg();
                            layer.msg(i18n.prop(sre.msg));

                        } else {
                            layui.data('YDH-Marketing', {
                                key: 'Secret'
                                , value: sre.tokenKey
                            });
                            layui.data('YDH-Marketing', {
                                key: 'email'
                                , value: sre.email
                            });
                            if (!YDHMarketing.MarketingCode || YDHMarketing.MarketingCode == "manage" || YDHMarketing.MarketingCode == "") {
                                window.location.href = "/Marketing/MKIndex.html";
                            }
                            else {
                                window.location.href = "/Marketing/MKInVite.html?MarketingCode=" + YDHMarketing.MarketingCode;
                            }

                        }
                        return false;
                    }
                });
                return false;
            });

            (function ($) {
                $.getUrlParam = function (name) {
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                    var r = window.location.search.substr(1).match(reg);
                    if (r != null) return unescape(r[2]); return null;
                }
            })(jQuery);

            // 进行注册
            $(document).on('click', '.register', function () {

                var username = $("#RegName").val();
                if (!username) {
                    layer.msg('Username cannot be empty！');
                    return false;
                }

                var Email = $("#RegEmail").val();
                if (!Email) {
                    layer.msg('Email adress cannot be empty！');
                    return false;
                }
                var code = $("#RegCode").val();
                if (!code) {
                    layer.msg('Verification code cannot be empty！');
                    return false;
                }
                var password = $("#RegPsd").val();
                if (!password) {
                    layer.msg('Password cannot be empty！');
                    return false;
                }
                var business = $('#select').find('option:selected').val();;
                if (!business) {
                    layer.msg('Please select your business！');
                    return false;
                }

                var Encrypt = $.md5(password);

                $.ajax({
                    type: "post",
                    url: BackgroundDomain + "/api/Login/InsertCustomerByMarketing",
                    contentType: "application/json;",
                    data: JSON.stringify({ "Email": Email, "Pw": Encrypt, "VerificationCode": code, "UserName": username, "BusinessId": business, "IsUpdate": false, "InvitationCode": YDHMarketing.MarketingCode }),
                    dataType: "json",
                    success: function (sre) {
                        if (sre) {
                            layui.data('YDH-Marketing', {
                                key: 'Secret'
                                , value: sre.data
                            });
                            layui.data('YDH-Marketing', {
                                key: 'email'
                                , value: username
                            });
                            if (!YDHMarketing.MarketingCode || YDHMarketing.MarketingCode == "manage" || YDHMarketing.MarketingCode == "") {
                                window.location.href = "/Marketing/MKIndex.html";
                            }
                            else {
                                window.location.href = "/Marketing/MKInVite.html?MarketingCode=" + YDHMarketing.MarketingCode;
                            }
                            return false;
                        }
                    }
                });
                return false;
            });

            //修改密码
            $(document).on('click', '.confirm', function () {
                var Email = $("#up_Emial").val();
                if (!Email) {
                    layer.msg('Email address cannot be empty！');
                    return false;
                }
                var code = $("#up_code").val();
                if (!code) {
                    layer.msg('Verification code cannot be empty！');
                    return false;
                }
                var password = $("#up_Psd").val();
                if (!password) {
                    layer.msg('Password cannot be empty！');
                    return false;
                }

                var Encrypt = $.md5(password);

                $.ajax({
                    type: "post",
                    url: BackgroundDomain + "/api/Login/UpdateCustomerPsdByEmail",
                    contentType: "application/json;",
                    data: JSON.stringify({ "Email": Email, "Pw": Encrypt, "VerificationCode": code, "IsUpdate": true }),
                    dataType: "json",
                    success: function (sre) {
                        if (sre) {
                            layui.data('YDH-Marketing', {
                                key: 'Secret'
                                , value: sre.data
                            });
                            layui.data('YDH-Marketing', {
                                key: 'email'
                                , value: Email
                            });
                            if (!YDHMarketing.MarketingCode || YDHMarketing.MarketingCode == "manage" || YDHMarketing.MarketingCode == "") {
                                window.location.href = "/Marketing/MKIndex.html";
                            }
                            else {
                                window.location.href = "/Marketing/MKInVite.html?MarketingCode=" + YDHMarketing.MarketingCode;
                            }
                            return false;
                        }
                    }
                });

            })


            //登录的用户框获得焦点事件 email
            $("#email").focus(function () {
                $("#icon-email").addClass("icon");
            })
            //登录的用户框失去焦点事件
            $("#email").blur(function () {
                var value = $('#email').val()
                if (value == "") {
                    $("#icon-email").removeClass("icon");
                }
            })
            //登录的密码框获取焦点事件 pwd
            $("#pwd").focus(function () {
                $("#icon-pwd").addClass("icon");
            })
            //登录的密码框失去焦点事件
            $("#pwd").blur(function () {
                var value = $('#pwd').val()
                if (value == "") {
                    $("#icon-pwd").removeClass("icon");
                }
            })


            //注册的用户框获得焦点事件 email
            $("#RegName").focus(function () {
                $("#icon-reg-name").addClass("icon");
            })
            //注册的email框失去焦点事件
            $("#RegName").blur(function () {
                var value = $('#RegName').val()
                if (value == "") {
                    $("#icon-reg-name").removeClass("icon");
                }
            })
            //注册的email框获得焦点事件 email
            $("#RegEmail").focus(function () {
                $("#icon-reg-email").addClass("icon");
            })
            //注册的email框失去焦点事件
            $("#RegEmail").blur(function () {
                var value = $('#RegEmail').val()
                if (value == "") {
                    $("#icon-reg-email").removeClass("icon");
                }
            })
            //注册的验证码框获取焦点事件 pwd
            $("#RegCode").focus(function () {
                $("#icon-reg-code").addClass("icon");
            })
            //注册的验证码框失去焦点事件
            $("#RegCode").blur(function () {
                var value = $('#RegCode').val()
                if (value == "") {
                    $("#icon-reg-code").removeClass("icon");
                }
            })
            //注册的密码框获取焦点事件 pwd
            $("#RegPsd").focus(function () {
                $("#icon-reg-psd").addClass("icon");
            })
            //注册的密码框失去焦点事件
            $("#RegPsd").blur(function () {
                var value = $('#RegPsd').val()
                if (value == "") {
                    $("#icon-reg-psd").removeClass("icon");
                }
            })
            //注册的生意类型获取焦点事件 pwd
            $(".layui-unselect").focus(function () {
                $("#icon-reg-business").addClass("icon");
            })

            //修改密码的email框获得焦点事件 email
            $("#up_Emial").focus(function () {
                $("#icon-up-email").addClass("icon");
            })
            //修改密码的email框失去焦点事件
            $("#up_Emial").blur(function () {
                var value = $('#up_Emial').val()
                if (value == "") {
                    $("#icon-up-email").removeClass("icon");
                }
            })
            //修改密码的验证码框获取焦点事件 pwd
            $("#up_code").focus(function () {
                $("#icon-up-code").addClass("icon");
            })
            //修改密码的验证码框失去焦点事件
            $("#up_code").blur(function () {
                var value = $('#up_code').val()
                if (value == "") {
                    $("#icon-up-code").removeClass("icon");
                }
            })
            //修改密码的密码框获取焦点事件 pwd
            $("#up_Psd").focus(function () {
                $("#icon-up-psd").addClass("icon");
            })
            //修改密码的密码框失去焦点事件
            $("#up_Psd").blur(function () {
                var value = $('#up_Psd').val()
                if (value == "") {
                    $("#icon-up-psd").removeClass("icon");
                }
            })


        });
        var clock = '';
        var nums = 60;
        var btn;
        var btnName;
        //邮件发验证码
        function SendCode(thisBtn) {
            if (nums < 60) {
                clock = setInterval(doLoop, 1000); //一秒执行一次
                return false;
            }
            btn = thisBtn;
            //btn.innerHTML = nums + 'S';
            var user = new Object();
            var btnid = $(thisBtn).attr("id");
            if (btnid == "regSendCode") {
                user.Email = document.getElementById('RegEmail').value;
            }
            else {
                user.Email = document.getElementById('up_Emial').value;
            }
            if (!user.Email) {
                layer.msg('Email address cannot be empty! ', { icon: 5, time: 3000, shade: 0.4 });
                return false;
            }

            $.ajax({
                type: "post",
                url: BackgroundDomain + "/api/Login/GetVerificationCode",
                contentType: "application/json;",
                data: JSON.stringify(user),
                dataType: "json",
                success: function (sre) {
                    if (sre.code) {
                        layer.msg('Send successfully!');
                    }

                }
            })

            clock = window.setInterval(doLoop, 1000); //一秒执行一次
        }


        function doLoop() {
            nums--;
            if (nums > 0) {
                btn.innerHTML = nums + 'S';
            } else {
                window.clearInterval(clock); //清除js定时器
                btn.innerHTML = 'Send code';
                nums = 60; //重置时间
            }
        }
    </script>
</body>

</html>